{% extends "base.html" %}
{% block title %}{{ strings.cart_title }}{% endblock %}
{% block content %}
<div class="container">
    <div class="card">
        <div class="card-header">
            <h2 class="section-title">{{ strings.cart }}</h2>
            <span class="badge">{{ cart|length }}</span>
        </div>
        <button type="button" class="btn btn-outline" onclick="openScanner()">{{ strings.scan_qr }}</button>
        <div id="cartList">
            {% if cart %}
            {% for item in cart %}
            <div class="cart-row"><span class="cart-name">{{ item.name }}</span><span class="cart-price">{{ strings.currency }} {{ "%.2f"|format(item.price) }}</span></div>
            {% endfor %}
            <div class="cart-total-row"><span class="cart-total-label">{{ strings.total }}</span><span class="cart-total-value">{{ strings.currency }} {{ "%.2f"|format(cart_total) }}</span></div>
            <button type="button" class="btn btn-primary" onclick="preparePrintFromCart()" style="margin-top:12px">{{ strings.print_cart }}</button>
            <button type="button" class="btn btn-danger" onclick="clearCart()" style="margin-top:8px">{{ strings.clear_cart }}</button>
            {% else %}
            <p class="empty-text">{{ strings.cart_empty }} <a href="{{ url_for('products') }}">{{ strings.nav_products }}</a>.</p>
            {% endif %}
        </div>
    </div>
</div>

<div id="printModal" class="modal">
    <div class="modal-content print-modal-content">
        <div class="print-header"><h2>{{ strings.print_preview }}</h2><div class="print-actions"><button type="button" class="btn btn-primary" onclick="window.print()">{{ strings.print }}</button><button type="button" class="btn btn-outline" onclick="closePrintModal()">{{ strings.close }}</button></div></div>
        <div id="printContent" class="print-content"></div>
    </div>
</div>

<div id="scannerModal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><h2>{{ strings.scan_qr_modal }}</h2><button type="button" class="close-btn" onclick="closeScanner()">&times;</button></div>
        <div class="scanner-container">
            <video id="video" autoplay playsinline webkit-playsinline muted></video>
            <canvas id="canvas" style="display:none"></canvas>
            <div class="scanner-overlay-ui"><div class="scanner-frame"></div><button id="switchCameraBtn" type="button" class="camera-switch-btn" onclick="switchCamera()" title="{{ strings.switch_camera }}" style="display:none">&#8634;</button></div>
        </div>
        <p id="scannerStatus" class="scanner-status">{{ strings.point_camera }}</p>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
{{ super() }}
{% endblock %}
